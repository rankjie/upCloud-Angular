// Generated by CoffeeScript 1.6.3
var Controllers, LogApp, baseURL;

baseURL = 'http://localhost:3000';

LogApp = angular.module('LogApp', ['ngCookies']);

Controllers = {};

Controllers['FormController'] = function($scope, $http, $cookieStore) {
  $scope.checkEmail = function() {
    var mail;
    mail = $scope.email;
    if (/.*@(upai.com|huaban.com|upyun.com|yupoo.com|widget-inc.com)$/g.test(mail)) {
      $scope.emailWrong = false;
      return $http.post(baseURL + '/api/users/check', {
        email: $scope.email
      }).success(function(res) {
        if (res.reg) {
          $scope.isReg = true;
          return $scope.action = 'Log in';
        } else {
          $scope.isReg = false;
          return $scope.action = 'Sign in';
        }
      });
    } else {
      $scope.emailError = "illegal email";
      return $scope.emailWrong = true;
    }
  };
  $scope.checkPWD = function() {
    if ($scope.pwd !== $scope.pwd_repeat) {
      return $scope.pwdWrong = true;
    } else {
      $scope.pwdWrong = false;
      return $scope.pwdError = 'password do not match';
    }
  };
  return $scope.submit = function() {
    if ($scope.pwd_repeat != null) {
      return $http.post(baseURL + '/api/users', {
        email: $scope.email,
        password: $scope.pwd
      }).success(function(res) {
        console.log('reg suc' + res);
        return $cookieStore.put('user_id', res.id);
      }).error(function(err) {
        console.log(err);
        return alert(err);
      });
    } else {
      return $http.post(baseURL + '/api/session', {
        email: $scope.email,
        password: $scope.pwd
      }).success(function(res) {
        console.log('log suc' + res);
        return $cookieStore.put('user_id', res.id);
      }).error(function(err) {
        console.log(err);
        return alert(err);
      });
    }
  };
};

LogApp.controller(Controllers);
